#!/bin/zsh

# ëª¨ë“  ë¹Œë“œ ë¬¸ì œ í•´ê²° - ì˜¬ì¸ì› ìŠ¤í¬ë¦½íŠ¸
# Gradle ìºì‹œ ì†ìƒ, ë¹Œë“œ ì—ëŸ¬, íŒŒì¼ëª… ë¬¸ì œ ë“± ëª¨ë“  ê²ƒì„ í•œ ë²ˆì— í•´ê²°

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  ğŸ”§ Android ë¹Œë“œ ë¬¸ì œ ì™„ì „ í•´ê²° ìŠ¤í¬ë¦½íŠ¸   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ë‹¤ìŒ ë¬¸ì œë“¤ì„ ëª¨ë‘ í•´ê²°í•©ë‹ˆë‹¤:"
echo "  â€¢ Gradle ìºì‹œ ì†ìƒ (metadata.bin ì—ëŸ¬)"
echo "  â€¢ íŒŒì¼ëª… ê²€ì¦ ì‹¤íŒ¨ (ê³µë°± í¬í•¨ íŒŒì¼)"
echo "  â€¢ ë¹Œë“œ ìºì‹œ ë¬¸ì œ"
echo "  â€¢ Android Studio ìºì‹œ ë¬¸ì œ"
echo ""

read "response?ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (Y/n): "
if [[ "$response" =~ ^[Nn]$ ]]; then
    echo "ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."
    exit 0
fi

cd "$(dirname "$0")"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "1ï¸âƒ£  í”„ë¡œì íŠ¸ ë¹Œë“œ í´ë” ì •ë¦¬"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

project_dirs=(
    "app/build"
    "build"
    ".gradle"
    ".idea/caches"
    ".idea/libraries"
    "app/.cxx"
    "app/.externalNativeBuild"
)

for dir in "${project_dirs[@]}"; do
    if [ -d "$dir" ]; then
        echo "  ğŸ—‘ï¸  $dir"
        rm -rf "$dir"
    fi
done
echo "  âœ… ì™„ë£Œ"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "2ï¸âƒ£  Gradle ì „ì—­ ìºì‹œ ì™„ì „ ì‚­ì œ (í•µì‹¬!)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

gradle_dirs=(
    "$HOME/.gradle/caches"
    "$HOME/.gradle/daemon"
    "$HOME/.gradle/kotlin-dsl"
    "$HOME/.gradle/wrapper"
)

for dir in "${gradle_dirs[@]}"; do
    if [ -d "$dir" ]; then
        echo "  ğŸ—‘ï¸  $(basename $dir)"
        rm -rf "$dir"
    fi
done
echo "  âœ… ì™„ë£Œ - Gradleì´ ë‹¤ìŒ ë¹Œë“œ ì‹œ ìë™ ì¬ìƒì„±í•©ë‹ˆë‹¤"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "3ï¸âƒ£  Android Studio ìºì‹œ ì •ë¦¬"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Android Studio ë²„ì „ë³„ ìºì‹œ
if ls -d "$HOME/Library/Caches/Google/AndroidStudio"* 2>/dev/null; then
    echo "  ğŸ—‘ï¸  Android Studio ìºì‹œ ì‚­ì œ"
    rm -rf "$HOME/Library/Caches/Google/AndroidStudio"*
    echo "  âœ… ì™„ë£Œ"
else
    echo "  â„¹ï¸  Android Studio ìºì‹œ ì—†ìŒ"
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "4ï¸âƒ£  ë¬¸ì œ íŒŒì¼ ê²€ìƒ‰ ë° ì‚­ì œ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# ê³µë°±ì´ í¬í•¨ëœ ë¦¬ì†ŒìŠ¤ íŒŒì¼ ê²€ìƒ‰
found_issues=0
if [ -d "app/src/main/res" ]; then
    while IFS= read -r file; do
        if [[ "$file" == *" "* ]] && [[ "$file" == *.xml ]]; then
            echo "  âš ï¸  ë°œê²¬: $file"
            rm -f "$file"
            echo "     âœ… ì‚­ì œë¨"
            found_issues=1
        fi
    done < <(find app/src/main/res -type f -name "*.xml" 2>/dev/null)

    if [ $found_issues -eq 0 ]; then
        echo "  âœ… ë¬¸ì œ íŒŒì¼ ì—†ìŒ"
    fi
else
    echo "  â„¹ï¸  res í´ë” ì—†ìŒ"
fi

# .DS_Store íŒŒì¼ ì •ë¦¬
find . -name ".DS_Store" -type f -delete 2>/dev/null
echo "  âœ… macOS ë©”íƒ€ë°ì´í„° ì •ë¦¬ ì™„ë£Œ"

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "5ï¸âƒ£  Gradle Wrapper ê²€ì¦"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

if [ -f "gradlew" ]; then
    chmod +x gradlew
    echo "  âœ… gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ ì™„ë£Œ"
else
    echo "  âš ï¸  gradlew íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤!"
fi

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘             âœ¨ ì •ë¦¬ ì™„ë£Œ! âœ¨                  â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“± ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”:"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ë°©ë²• A: Android Studioì—ì„œ (ê¶Œì¥ â­)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  1. Android Studioë¥¼ ì™„ì „íˆ ì¢…ë£Œ"
echo "  2. Android Studio ì¬ì‹œì‘"
echo "  3. File > Invalidate Caches / Restart"
echo "  4. 'Invalidate and Restart' ë²„íŠ¼ í´ë¦­"
echo "  5. í”„ë¡œì íŠ¸ê°€ ìë™ìœ¼ë¡œ Gradle Sync ì‹œì‘"
echo "  6. Sync ì™„ë£Œ í›„: Build > Rebuild Project"
echo "  7. ì•± ì‹¤í–‰ â–¶ï¸"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ë°©ë²• B: í„°ë¯¸ë„ì—ì„œ ë°”ë¡œ (ë¹ ë¦„ ğŸš€)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "  ./gradlew clean --refresh-dependencies"
echo "  ./gradlew build"
echo ""
echo "  ê·¸ ë‹¤ìŒ Android Studioì—ì„œ ì•± ì‹¤í–‰"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ’¡ Tip:"
echo "  â€¢ ë°©ë²• Aê°€ ê°€ì¥ í™•ì‹¤í•©ë‹ˆë‹¤"
echo "  â€¢ ë¬¸ì œê°€ ê³„ì†ë˜ë©´ ì»´í“¨í„°ë¥¼ ì¬ë¶€íŒ…í•˜ì„¸ìš”"
echo "  â€¢ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš” (Gradleì´ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤)"
echo ""

# ìë™ ì‹¤í–‰ ì˜µì…˜ ì œê³µ
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
read "auto_run?ì§€ê¸ˆ ë°”ë¡œ Gradle Cleanì„ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N): "
if [[ "$auto_run" =~ ^[Yy]$ ]]; then
    echo ""
    echo "ğŸš€ Gradle Clean ì‹¤í–‰ ì¤‘..."
    if [ -f "gradlew" ]; then
        ./gradlew clean --refresh-dependencies
        echo ""
        echo "âœ… Clean ì™„ë£Œ!"
        echo "ì´ì œ Android Studioì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ì—´ê³  ë¹Œë“œí•˜ì„¸ìš”."
    else
        echo "âš ï¸  gradlew íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
        echo "Android Studioì—ì„œ File > Sync Projectë¥¼ ì‹¤í–‰í•˜ì„¸ìš”."
    fi
else
    echo ""
    echo "ğŸ‘ ì¢‹ìŠµë‹ˆë‹¤! ìœ„ì˜ ë°©ë²• A ë˜ëŠ” Bë¥¼ ë”°ë¼í•˜ì„¸ìš”."
fi

echo ""

